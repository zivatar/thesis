{% extends 'climate/base.html' %}
{% load staticfiles %}
{% load widget_tweaks %}

{% block title %}Havi adatlap: {{site.title}}, {{month.year}}.{{month.getMonth}}. {% endblock %}

{% block content %}
<div class="panel panel-primary">
	<div class="panel-heading">
		<span class="glyphicon glyphicon-cloud"></span> Éghajlati napló kitöltése
	</div>
	<div class="panel-body">
	<p>Mérőhely: {{site.title}}</p>
	<p>Aktuális hónap: {{month.year}}.{{month.getMonth}}.</p>{{actualData}}
	
		<div class="table-responsive">
			<table class="table table-striped valign-center">
				<thead>
					<tr>
						<th>Nap</th>
						<th>Tmin</th>
						<th>Tmax</th>
						<th>Csapadék</th>
						<th>Szignifikáns jelenségek</th>
					</tr>
				</thead>
				<tbody>
					{% for day in month.daysOfMonthTillToday %}
						<tr>
							<td>{{day}}</td>
							<td><input class="narrow" type="number" step=0.1 id="Tmin{{day}}"></td>
							<td><input class="narrow" type="number" step=0.1 id="Tmax{{day}}"></td>
							<td><input class="narrow" type="number" min=0 step=0.5 id="prec{{day}}"></td>
							<td><a><span class="glyphicon glyphicon-ok-sign right"></span></a></td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>

<script>
	data = {};
	{% for day in month.daysOfMonthTillToday %}
		function handleInputChange(inputName, day, elemId) {
			var value = document.getElementById(elemId).value;
			if (!data[day]) {
				data[day] = {}
			}
			switch (inputName) {
				case "Tmax":
					data[day].Tmax = value == "" ? undefined : value;
					break;
				case "Tmin":
					data[day].Tmin = value == "" ? undefined : value;
					break;
				case "prec":
					data[day].prec = value == "" ? undefined : value;
					break;
			}
			if (data[day].Tmin == undefined && data[day].Tmax == undefined && data[day].prec == undefined) {
				data[day] = null;
			}
		}

		document.getElementById("Tmax{{day}}").onchange = function() { handleInputChange("Tmax",{{day}},"Tmax{{day}}") };
		document.getElementById("Tmin{{day}}").onchange = function() { handleInputChange("Tmin",{{day}},"Tmin{{day}}") };
		document.getElementById("prec{{day}}").onchange = function() { handleInputChange("prec",{{day}},"prec{{day}}") };
	{% endfor %}
</script>
{% endblock content %}